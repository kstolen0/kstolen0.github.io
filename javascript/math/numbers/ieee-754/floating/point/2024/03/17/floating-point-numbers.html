<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/assets/normalize.css">
  <link rel="stylesheet" href="/assets/open-color.css">
  <link rel="stylesheet" href="/assets/monophase/styles.css">
  <link type="application/atom+xml" rel="alternate" href="https://kristianstolen.com/feed.xml" title="Stolen Ideas" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>0.1 + 0.2 or I Dont Understand Floating Point Numbers | Stolen Ideas</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="0.1 + 0.2 or I Dont Understand Floating Point Numbers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Why does my programming language sometimes not know how to do math? Why the answer is obvious, once you realize we have a lot of numbers, and only so many bits to work with" />
<meta property="og:description" content="Why does my programming language sometimes not know how to do math? Why the answer is obvious, once you realize we have a lot of numbers, and only so many bits to work with" />
<link rel="canonical" href="https://kristianstolen.com/javascript/math/numbers/ieee-754/floating/point/2024/03/17/floating-point-numbers.html" />
<meta property="og:url" content="https://kristianstolen.com/javascript/math/numbers/ieee-754/floating/point/2024/03/17/floating-point-numbers.html" />
<meta property="og:site_name" content="Stolen Ideas" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-17T08:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="0.1 + 0.2 or I Dont Understand Floating Point Numbers" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-17T08:00:00+00:00","datePublished":"2024-03-17T08:00:00+00:00","description":"Why does my programming language sometimes not know how to do math? Why the answer is obvious, once you realize we have a lot of numbers, and only so many bits to work with","headline":"0.1 + 0.2 or I Dont Understand Floating Point Numbers","mainEntityOfPage":{"@type":"WebPage","@id":"https://kristianstolen.com/javascript/math/numbers/ieee-754/floating/point/2024/03/17/floating-point-numbers.html"},"url":"https://kristianstolen.com/javascript/math/numbers/ieee-754/floating/point/2024/03/17/floating-point-numbers.html"}</script>
<!-- End Jekyll SEO tag -->


  <script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>
  
  

</head>

  <body>
    <div class="container">
      <header class="masthead">
  <div class="masthead-title">
    <a href="/" title="Home">Stolen Ideas</a>
    <small class="tagline">Thoughts and learnings about software development</small>
  </div>

  
</header>


      <main>
        <article class="post">
  <h1 class="post-title">0.1 + 0.2 or I Dont Understand Floating Point Numbers</h1>
  <div class="post-meta">
    <time datetime="2024-03-17T08:00:00+00:00" itemprop="datePublished">
      17 Mar 2024
    </time>
      <span> • </span>
      <span class="post-categories-section">
        <i class="post-categories-icon fas fa-folder"></i>
        <ul class="post-categories"><li>
              <span class="post-category">javascript</span></li><li>
              <span class="post-category">math</span></li><li>
              <span class="post-category">numbers</span></li><li>
              <span class="post-category">ieee-754</span></li><li>
              <span class="post-category">floating</span></li><li>
              <span class="post-category">point</span></li></ul>
      </span>
    
    
  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>What's 0.1 + 0.2?
</code></pre></div></div>

<p>If someone were to ask me this I’d calmly respond, <code class="language-plaintext highlighter-rouge">0.3</code> and carry on with my day. But when I open a Node console or my developer console in my browser and enter <code class="language-plaintext highlighter-rouge">0.1 + 0.2</code>. What is the result?</p>

<p><img src="/assets/2024-03-08-floating-point-numbers/01-plus-02.PNG" alt="0.1 plus 0.2 is in fact 0.30000000000000004 When using floating point numbers" /></p>

<p>Once again, Javascript is up to its old tricks… But I shouldn’t give Javascript all the credit here. Javascript has simply implemented its <code class="language-plaintext highlighter-rouge">Number</code> type to follow a widely used double floating point number standard known as IEEE-754.</p>

<p>How many numbers are there? Quite a few… There’s 1, 2, 3, 42, and much, much more! And how many numbers are between 1 and 2?<br />
There’s 1.1, 1.01, 1.001, 1.945671456000000012314440014444000148478, we’re just scratching the surface here, but let’s say also a lot! How many bits of memory are available in my computer? Probably fewer than there are numbers. How can my computer represent so many numbers with such little space?</p>

<h2 id="the-ieee-754-standard-for-floating-point-arithmetic">The IEEE-754 Standard for Floating Point Arithmetic</h2>

<p>Computers need a way to capture all these numbers with a limited amount of space. Many systems had developed their own implementations for managing this, but this made for poor reliability and portability. The IEEE-754 floating point number standard was developed to fix this. So how does it work? Floating point formats can be of varying sizes:</p>
<ul>
  <li>16 bit floating point (aka Half)</li>
  <li>32 bit floating point (aka Single)</li>
  <li>64 bit floating point (aka Double), etc</li>
</ul>

<p>For the sake of brevity, I’ll use 16 bit floating point as an example.</p>

<p>Given 16 bits:</p>

<ul>
  <li>1 bit for the sign <code class="language-plaintext highlighter-rouge">sign</code> (if the number is positive or negative)</li>
  <li>5 bits for the <code class="language-plaintext highlighter-rouge">exponent</code> (This represents the biased exponent and determines where the floating decimal will be placed)</li>
  <li>10 bits for the <code class="language-plaintext highlighter-rouge">mantissa</code> (The normalized number)</li>
</ul>

<p><img src="/assets/2024-03-08-floating-point-numbers/16-bit-fp-allocations.PNG" alt="the bit allocations in a 16 bit floating point number system" /></p>

<h2 id="lets-do-the-math">Lets do the math!</h2>

<p>Given the number <code class="language-plaintext highlighter-rouge">12.5</code>, I can do some math to convert it into floating point binary number:</p>

<p>As the number is positive, I set <code class="language-plaintext highlighter-rouge">sign</code> to <code class="language-plaintext highlighter-rouge">0</code>.</p>

<p><code class="language-plaintext highlighter-rouge">sign = 0</code></p>

<p>To calculate the mantissa, I first continuously divide the left-hand side of the decimal by 2 until the whole number reaches 0. 
Then I multiply the right-hand side of the decimal by 2 until the result has no remainder.</p>

<table>
  <thead>
    <tr>
      <th>whole number</th>
      <th>decimal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">12 / 2 = 6</code> - remainder 0(0)</td>
      <td><code class="language-plaintext highlighter-rouge">0.5 * 2 = 1.0</code> - 1</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">6 / 2 = 3</code>  - remainder 0(0)</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">3 / 2 = 1.5</code> - remainder 5(1)</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">1 / 2 = 0.5</code> - remainder 5(1)</td>
      <td> </td>
    </tr>
    <tr>
      <td>result: <code class="language-plaintext highlighter-rouge">1100</code></td>
      <td>result <code class="language-plaintext highlighter-rouge">1</code></td>
    </tr>
  </tbody>
</table>

<p>This results in <code class="language-plaintext highlighter-rouge">1100.1</code>.</p>

<p>I then normalize the mantissa to get the exponent:</p>

<p><code class="language-plaintext highlighter-rouge">1100.1 = 1.1001*2^3</code></p>

<p>I get the biased exponent by adding the number of non-signed bits to the exponent value.</p>

<p><code class="language-plaintext highlighter-rouge">3 + 15 = 18 = 10010</code></p>

<p>The format assumes a leading <code class="language-plaintext highlighter-rouge">1</code> in the mantissa so I can ignore it. This results in:</p>

<p><code class="language-plaintext highlighter-rouge">0 10010 1001000000</code></p>

<p><img src="/assets/2024-03-08-floating-point-numbers/12-point-5-16-bit-fp.PNG" alt="12.5 in half floating point binary is 01001010010000000" /></p>

<h2 id="so-what">So What?</h2>

<p>OK, that’s cool and all but this still doesn’t explain why <code class="language-plaintext highlighter-rouge">0.1 + 0.2 = 0.30000000000000004</code>!</p>

<p>Why don’t I do this calculation again, but this time I’ll convert <code class="language-plaintext highlighter-rouge">0.1</code> into 16 bit floating point binary.</p>

<p><code class="language-plaintext highlighter-rouge">0.1</code> is a positive number, so <code class="language-plaintext highlighter-rouge">sign</code> is easy:</p>

<p><code class="language-plaintext highlighter-rouge">sign = 0</code>.</p>

<p>Now to get our mantissa:</p>

<table>
  <thead>
    <tr>
      <th>whole number</th>
      <th>decimal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">0 / 2 = 0 </code> - remainder 0(0)</td>
      <td><code class="language-plaintext highlighter-rouge">0.1 * 2 = 0.2</code> 0</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">0.2 * 2 = 0.4</code> 0</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">0.4 * 2 = 0.8</code> 0</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">0.8 * 2 = 1.6</code> 1</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">0.6 * 2 = 1.2</code> 1</td>
    </tr>
    <tr>
      <td> </td>
      <td><code class="language-plaintext highlighter-rouge">0.2 * 2 = 0.4</code> 0  !!</td>
    </tr>
    <tr>
      <td>result: <code class="language-plaintext highlighter-rouge">0</code></td>
      <td>result <code class="language-plaintext highlighter-rouge">0001100110</code></td>
    </tr>
  </tbody>
</table>

<p>The calculation loops back on itself after calculating  <code class="language-plaintext highlighter-rouge">0.6 * 2</code>!</p>

<p>Using the 10 bits of space we have available we get:</p>

<p><code class="language-plaintext highlighter-rouge">0.0001100110</code>.</p>

<p>To get the exponent, I normalize the value and add the bias:</p>

<p><code class="language-plaintext highlighter-rouge">1.1*2^-4</code></p>

<p><code class="language-plaintext highlighter-rouge">-4 + 15 = 11 = 01011</code></p>

<p>result:
<code class="language-plaintext highlighter-rouge">0 01011 0001100110</code></p>

<p>The issue here is that I haven’t captured the exact value of 0.1 in our conversion. There’s an infinite series of <code class="language-plaintext highlighter-rouge">0011</code> that follows here.<br />
The same issue occurs when calculating <code class="language-plaintext highlighter-rouge">0.2</code>.</p>

<p>Now I see why some numbers result in unexpected calculations. Just as <code class="language-plaintext highlighter-rouge">1/3</code> cannot be precisely captured in decimal notation, (there’s an infinite amount of recurring 3s), some decimal values cannot be precisely captured in floating point numbers.</p>

<p>When converting numbers too large for the bit capacity, the number may be rounded up or rounded down to the nearest bit depending on if the next bit is a <code class="language-plaintext highlighter-rouge">0</code> or <code class="language-plaintext highlighter-rouge">1</code>.</p>

<p>In the case of <code class="language-plaintext highlighter-rouge">0.1 + 0.2</code>, here we can see that both 64bit floating point binary numbers are rounded up to the next bit which results in the <code class="language-plaintext highlighter-rouge">0100</code> (4) at the tail end of our result.</p>

<table>
  <tbody>
    <tr>
      <td> 0.1</td>
      <td>0 01111111011 1001100110011001100110011001100110011001100110011010</td>
    </tr>
    <tr>
      <td>+ 0.2</td>
      <td>0 01111111100 1001100110011001100110011001100110011001100110011010</td>
    </tr>
    <tr>
      <td>= 0.3</td>
      <td>0 01111111101 0011001100110011001100110011001100110011001100110100</td>
    </tr>
  </tbody>
</table>

<h2 id="in-conclusion">In Conclusion</h2>

<p>The IEEE-754 floating point number system is a great tool for representing a large array of numbers with some small quirks that surprises developers on occasion.</p>

<p>In most scenarios, these minor rounding errors wont dramatically change the result of a calculation, (being 0.00000000000000004 off the result is not a game changer).</p>

<p>Where they do become important is when doing comparisons, e.g. <code class="language-plaintext highlighter-rouge">(x + y === 3)</code> or when presenting these results to humans.</p>

<p>When working with floating point numbers it’s important to account for these scenarios and potentially limit the decimal places or parse the values as Integers.</p>

<p>A common solution for avoiding this is to only work with whole numbers (e.g. cents instead of dollars).</p>

<p>Now, the next time someone asks me <code class="language-plaintext highlighter-rouge">what is 0.1 plus 0.2?</code> I will have a new opportunity to answer <code class="language-plaintext highlighter-rouge">It depends.</code>.</p>

<h2 id="other-interesting-quirks-of-floating-point-numbers">Other interesting quirks of Floating Point numbers</h2>

<p>As the sign and mantissa are distinct values, this standard can create some interesting values:<br />
(16 bit floating point binaries shown for brevity)</p>

<table>
  <tbody>
    <tr>
      <td>Infinity</td>
      <td>0 11111 0000000000</td>
    </tr>
    <tr>
      <td>-Infinity</td>
      <td>1 11111 0000000000</td>
    </tr>
    <tr>
      <td>0</td>
      <td>0 00000 0000000000</td>
    </tr>
    <tr>
      <td>-0</td>
      <td>1 00000 0000000000</td>
    </tr>
    <tr>
      <td>NaN</td>
      <td>0 11111 0000000001</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>When the exponent is all <code class="language-plaintext highlighter-rouge">1</code>s and mantissa is all <code class="language-plaintext highlighter-rouge">0</code>s this is considered <code class="language-plaintext highlighter-rouge">Infinity</code></li>
  <li>When the sign is <code class="language-plaintext highlighter-rouge">1</code> <code class="language-plaintext highlighter-rouge">Infinity</code> naturally becomes <code class="language-plaintext highlighter-rouge">-Infinity</code></li>
  <li>When the exponent is all <code class="language-plaintext highlighter-rouge">0</code>s and mantissa is all <code class="language-plaintext highlighter-rouge">0</code>s the result is <code class="language-plaintext highlighter-rouge">0</code></li>
  <li>Again, when the sign is <code class="language-plaintext highlighter-rouge">1</code> we get <code class="language-plaintext highlighter-rouge">-0</code></li>
  <li>When the exponent is all <code class="language-plaintext highlighter-rouge">1</code>s and the mantissa is a non <code class="language-plaintext highlighter-rouge">0</code> value, this is considered Not a Number (<code class="language-plaintext highlighter-rouge">NaN</code>)</li>
</ul>

<h2 id="further-reading--viewing">Further Reading / Viewing</h2>

<p>To learn more about this topic I highly recommend these:</p>

<ul>
  <li><a href="https://www.youtube.com/watch?v=RuKkePyo9zk">YT - Computer Science - IEEE 754 Standard for Floating Point Binary Arithmetic</a></li>
  <li><a href="https://www.youtube.com/watch?v=wPBjd-vb9eI">YT - Low Byte Productions - Why 0.1 + 0.2 === 0.30000000000000004: Implementing IEEE 754 in JS</a></li>
  <li><a href="https://www.youtube.com/watch?v=PZRI1IfStY0">YT - Computerphile - Floating Point Numbers</a></li>
  <li><a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">Wikipedia - Double-Precision Floating Point Format</a></li>
</ul>


  
</article>


  <aside class="related">
    <h2 class="related-title">Related posts</h2>
    <ul class="related-posts">
      
        <li>
          <a href="/aws/terraform/infratructure/iac/ecr/docker/2024/09/14/aws-terraform-02.html">
            Getting Started with AWS and Terraform: 02 - Hosting a dockerized web service in our EC2 container
          </a>
          <small><time datetime="2024-09-14T08:00:00+00:00">14 Sep 2024</time></small>
        </li>
      
        <li>
          <a href="/aws/terraform/infratructure/iac/2024/08/07/get-started-with-aws-tf-01.html">
            Getting Started with AWS and Terraform: 01 - Creating an EC2 Instance
          </a>
          <small><time datetime="2024-08-07T08:00:00+00:00">07 Aug 2024</time></small>
        </li>
      
        <li>
          <a href="/node/nodejs/typescript/jest/tsconfig/git/2023/06/24/node-ts-initialisation.html">
            Create a NodeJS project with Typescript & Jest
          </a>
          <small><time datetime="2023-06-24T16:00:00+00:00">24 Jun 2023</time></small>
        </li>
      
    </ul>
  </aside>


      </main>

      <footer class="footer">
  <div class="footer-column">
    <p>
      <small>
        &copy;&nbsp;<time datetime="2022-12-04T08:00:00+00:00">2022</time>-<time datetime="2024-10-02T13:14:27+00:00">2024</time>. All right reserved.
      </small>
    </p>
    <p>
      <small>
        Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/zivhub/monophase" target="_blank">Monophase</a>
      </small>
    </p>
  </div>
  
    <div class="footer-column">
      <ul class="social-icons">
        
          <li class="social-icon-item">
            <a class="social-icon" href="mailto:kristian@kristianstolen.com" target="_blank">
              <i class="fas fa-envelope" title="Email"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="https://github.com/kstolen0" target="_blank">
              <i class="fab fa-github" title="GitHub"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="https://www.linkedin.com/in/kstolen" target="_blank">
              <i class="fab fa-linkedin" title="LinkedIn"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="/feed.xml" target="_blank">
              <i class="fas fa-rss" title="RSS"></i>
            </a>
          </li>
        
      </ul>
    </div>
  
</footer>

    </div>

    

    
  </body>
</html>
