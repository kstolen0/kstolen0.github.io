<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/assets/normalize.css">
  <link rel="stylesheet" href="/assets/open-color.css">
  <link rel="stylesheet" href="/assets/monophase/styles.css">
  <link type="application/atom+xml" rel="alternate" href="https://kristianstolen.com/feed.xml" title="Stolen Ideas" />
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Refactoring towards valuable unit tests | Stolen Ideas</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="Refactoring towards valuable unit tests" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Poorly designed code can lead to poorly designed unit tests which can get in the way of delivering value. Here we discuss one refactoring technique to help prevent this." />
<meta property="og:description" content="Poorly designed code can lead to poorly designed unit tests which can get in the way of delivering value. Here we discuss one refactoring technique to help prevent this." />
<link rel="canonical" href="https://kristianstolen.com/unit/testing/refactoring/humble/object/engineering/practices/quality/assurance/qa/ci/cd/2023/02/08/refactoring-towards-valuable-unit-tests.html" />
<meta property="og:url" content="https://kristianstolen.com/unit/testing/refactoring/humble/object/engineering/practices/quality/assurance/qa/ci/cd/2023/02/08/refactoring-towards-valuable-unit-tests.html" />
<meta property="og:site_name" content="Stolen Ideas" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-02-08T08:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Refactoring towards valuable unit tests" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-02-08T08:00:00+00:00","datePublished":"2023-02-08T08:00:00+00:00","description":"Poorly designed code can lead to poorly designed unit tests which can get in the way of delivering value. Here we discuss one refactoring technique to help prevent this.","headline":"Refactoring towards valuable unit tests","mainEntityOfPage":{"@type":"WebPage","@id":"https://kristianstolen.com/unit/testing/refactoring/humble/object/engineering/practices/quality/assurance/qa/ci/cd/2023/02/08/refactoring-towards-valuable-unit-tests.html"},"url":"https://kristianstolen.com/unit/testing/refactoring/humble/object/engineering/practices/quality/assurance/qa/ci/cd/2023/02/08/refactoring-towards-valuable-unit-tests.html"}</script>
<!-- End Jekyll SEO tag -->


  <script async src="https://use.fontawesome.com/releases/v5.0.12/js/all.js"></script>
  
  

</head>

  <body>
    <div class="container">
      <header class="masthead">
  <div class="masthead-title">
    <a href="/" title="Home">Stolen Ideas</a>
    <small class="tagline">Thoughts and learnings about software development</small>
  </div>

  
</header>


      <main>
        <article class="post">
  <h1 class="post-title">Refactoring towards valuable unit tests</h1>
  <div class="post-meta">
    <time datetime="2023-02-08T08:00:00+00:00" itemprop="datePublished">
      08 Feb 2023
    </time>
      <span> • </span>
      <span class="post-categories-section">
        <i class="post-categories-icon fas fa-folder"></i>
        <ul class="post-categories"><li>
              <span class="post-category">unit</span></li><li>
              <span class="post-category">testing</span></li><li>
              <span class="post-category">refactoring</span></li><li>
              <span class="post-category">humble</span></li><li>
              <span class="post-category">object</span></li><li>
              <span class="post-category">engineering</span></li><li>
              <span class="post-category">practices</span></li><li>
              <span class="post-category">quality</span></li><li>
              <span class="post-category">assurance</span></li><li>
              <span class="post-category">QA</span></li><li>
              <span class="post-category">CI</span></li><li>
              <span class="post-category">CD</span></li></ul>
      </span>
    
    
  </div>

  <p>The aim of unit testing is to enable the sustainable growth of software systems. This means more than just writing tests that “prove” your code does what you expect, but also to ensure that further changes are not hindered by the existing code base (including the test suite). Enabling the use of effective unit tests often requires some refactoring of production code.</p>

<p>All code can be categorized along two dimensions:</p>
<ol>
  <li>Complexity / Domain significance</li>
  <li>Number of collaborators (aka dependencies)</li>
</ol>

<p>An indication of complex code can be a high cyclomatic complexity.</p>

<p>Domain significance describes how significant the code is to your core-domain. In a hexagonal architecture, this is typically all the code within your domain layer.</p>

<p>A collaborator is a type of dependency that is either mutable (e.g. a class that changes state), or an out-of-process dependency (e.g. a database). Immutable dependencies (values / value objects) do not count towards the number of collaborators.</p>

<p>These two dimensions provide us with four types of code:</p>

<h2 id="domain-model--algorithms">Domain model &amp; algorithms</h2>

<p>The domain model and algorithms not specific to the domain may often require complex code, but the number of collaborators should be limited.</p>

<h2 id="trivial-code">Trivial code</h2>

<p>Examples of this code are parameterless constructors or simple object properties. This code also has little domain significance.</p>

<h2 id="controllers">Controllers</h2>

<p>This code has many collaborators but doesn’t contain any complex logic and instead coordinates the work between other components with domain significance.</p>

<h2 id="overcomplicated-code">Overcomplicated code</h2>

<p>This is code that has a high number of collaborators, and also contains complex business logic or algorithms.</p>

<p><img src="/assets/2023-02-08-refactoring-to-valuable-unit-tests/code-quadrants.PNG" alt="the four code quadrants" /></p>

<p>Focusing your unit tests on the top left quadrant typically gives you the greatest return on your efforts and results in valuable test that are easy to write and maintain.</p>

<p>Trivial code should not require testing at all as these tests provide little value.</p>

<p>Testing controllers should be reserved for a limited number of integration tests.</p>

<p>Overcomplicated code should be split into it’s two its adjacent quadrants.</p>

<p><img src="/assets/2023-02-08-refactoring-to-valuable-unit-tests/remove-overcomplicated-code.PNG" alt="remove overcomplicated code" /></p>

<h1 id="welcome-the-humble-object-pattern">Welcome the Humble Object Pattern</h1>

<p>One method of simplifying overcomplicated code can be achieved using the humble object pattern. Complicated code that is difficult to test is often coupled to a framework dependency, such as UI or database.</p>

<p><img src="/assets/2023-02-08-refactoring-to-valuable-unit-tests/humble-object-before.PNG" alt="hard to test code" /></p>

<p>The humble object pattern removes the testable parts of the code out of the difficult to test component, the resulting component becomes a humble wrapper around the testable code.</p>

<p><img src="/assets/2023-02-08-refactoring-to-valuable-unit-tests/humble-object-after.PNG" alt="easy to test code" /></p>

<p>This pattern also follows the single responsibility principle, which states that each class should have only one responsibility. In this case it means separating out the business logic (code depth) from the orchestration of the system (code width). Your domain logic should be deep, but narrow (having few collaborators), and your controllers should be wide, but shallow (having little complexity).</p>

<p><img src="/assets/2023-02-08-refactoring-to-valuable-unit-tests/shallow-controller-narrow-logic.PNG" alt="shallow controllers and deep business logic" /></p>

<p>For more information on unit testing practices, check out <a href="https://www.manning.com/books/unit-testing">Unit Testing Principles, Practices, and Patterns</a> by Vladimir Khorikov. 
<img src="/assets/book-references/unit-testing-principles-practices-and-patterns.jpg" alt="unit testing principles practices and patterns" /></p>


  
</article>


  <aside class="related">
    <h2 class="related-title">Related posts</h2>
    <ul class="related-posts">
      
        <li>
          <a href="/aws/terraform/infratructure/iac/ecr/docker/2024/09/14/aws-terraform-02.html">
            Getting Started with AWS and Terraform: 02 - Hosting a dockerized web service in our EC2 container
          </a>
          <small><time datetime="2024-09-14T08:00:00+00:00">14 Sep 2024</time></small>
        </li>
      
        <li>
          <a href="/aws/terraform/infratructure/iac/2024/08/07/get-started-with-aws-tf-01.html">
            Getting Started with AWS and Terraform: 01 - Creating an EC2 Instance
          </a>
          <small><time datetime="2024-08-07T08:00:00+00:00">07 Aug 2024</time></small>
        </li>
      
        <li>
          <a href="/javascript/math/numbers/ieee-754/floating/point/2024/03/17/floating-point-numbers.html">
            0.1 + 0.2 or I Dont Understand Floating Point Numbers
          </a>
          <small><time datetime="2024-03-17T08:00:00+00:00">17 Mar 2024</time></small>
        </li>
      
    </ul>
  </aside>


      </main>

      <footer class="footer">
  <div class="footer-column">
    <p>
      <small>
        &copy;&nbsp;<time datetime="2022-12-04T08:00:00+00:00">2022</time>-<time datetime="2024-10-02T13:14:27+00:00">2024</time>. All right reserved.
      </small>
    </p>
    <p>
      <small>
        Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> & <a href="https://github.com/zivhub/monophase" target="_blank">Monophase</a>
      </small>
    </p>
  </div>
  
    <div class="footer-column">
      <ul class="social-icons">
        
          <li class="social-icon-item">
            <a class="social-icon" href="mailto:kristian@kristianstolen.com" target="_blank">
              <i class="fas fa-envelope" title="Email"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="https://github.com/kstolen0" target="_blank">
              <i class="fab fa-github" title="GitHub"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="https://www.linkedin.com/in/kstolen" target="_blank">
              <i class="fab fa-linkedin" title="LinkedIn"></i>
            </a>
          </li>
        
          <li class="social-icon-item">
            <a class="social-icon" href="/feed.xml" target="_blank">
              <i class="fas fa-rss" title="RSS"></i>
            </a>
          </li>
        
      </ul>
    </div>
  
</footer>

    </div>

    

    
  </body>
</html>
